= 원격 연결: 네트워크에 연결된 서버에 안전하게 접근하기

:icons: font
:Author: Byeongsoon Jang
:Email: qudtns1223@gmail.com
:Date: 2020.03.30
:Revision: 1.0
:imagesdir: ./image

'모던 리눅스 관리 - 데이비드 클린턴'의 3장을 학습한 내용이다.

원격으로 서버에 접속하는 ssh와 패스워드없이 접근하기, scp등을 학습했다.

Ubuntu버전은 18.04.4를 사용한다.

Byeongsoon Jang<qudtns1223@gmail.com>

---

=== 암호와의 중요성

예전에 대표적으로 원격 로그인할 수 있는 텔넷이 있었다.

텔넷 세션이 데이터 패킷을 암호화하지 않고 전송하는 것이 문제가 되어 사용하지 않게되었다.

SSH는 1990년대에 유닉스 계열 OS에서 원격 로그인할 때 전송되는 데이터를 안전하게 암호화 하려고 만들어졌다.

=== OpenSSH로 시작하기

보통 서버 버전으로 설치를하면 ssh가 설치되어 있지만 우분투/데비안 데스트톱 버전을 설치하면 별도로 설치를 해주어야 한다.

----
# sudo apt install openssh-server // ssh 서버 역할을 할 패키지를 다운로드

# systemctl status ssh // ssh가 실행 중인지 확인
----

=== ssh로 원격 서버에 로그인하기

원격에 있는 서버에 로그인 하는 것은 매우 간단하다.

우선 첫번째로 내가 접속하고자하는 서버 우분투의 IP를 알아야 한다.

----
# ifconfig

//위 명령어를 통하여 IP를 알아낸다.
----

image::ssh1.png[ifconfg]

기본적으로 로컬에서 VirtualBox로 생성한 우분투의 IP는 거의 다 10.0.2.15일 것이다.

그리고 나선 설정 - 네트워크 - 포트포워딩 에서 포트를 열어줘야지만 외부에서 접속이 가능하므로 다음과 같이 들어가서 22번(기본) 포트를 열어준다.

image::ssh2.png[설정-네트워크]
image::ssh3.png[포트포워딩]

포트포워딩을 할시에 저렇게 해두면 로컬로 작업할때 따로 IP를 입력 안해도 127.0.0.1(localhost)로 접속이 가능하다.

----
# ssh username@127.0.0.1

// 위 명령어 실행하면 패스워드 입력 창 나옴
----

원격접속이 이렇게나 간단하다.

==== 패스워드 없이 ssh 접근하기

ssh를 사용하다보면 로컬환경에사만 작업하는데도 접속할때마다 패스워드를 묻는다.

패스워드 입력이 많은 시간을 요하는건 아니지만 그래도 인증된 사용자에 한해선 자동으로 로그인되는 기능을 요구할 것이다.

우선 우분투로의 접속을 원하는 로컬 환경에서 다음과 같은 명령어로 암호화 키응 생성 후 공개키를 서버에 복사한다.

----
# ssh-keygen -t rsa -b 4096
# ssh username@127.0.0.1 mkdir -p .ssh // .ssh라는 디렉토리 생성
// 굳이 접속을 안해도 위와같은 방법으로 명령어 실행 가능
# cat .ssh/id_rsa.pub | ssh byeongsoon@127.0.0.1 "cat >> .ssh/authorized_keys" // 네트워크를 통해 공개키 복사
----

이렇게하면 ssh를 로그인할때 비밀번호를 묻지않고 바로 접속이 된다.

=== SCP로 안전하게 파일 복사하기

SCP 프로그램은 파일 전송을 위해 ssh 프로토콜을 사용해 어떤 파일이라도 동일한 키와 패스워드, 패스프레이즈로 여기저기에 복사할 수 있다.

다음 명령으로 파일이나 디렉토리 원격 호스트에 복사할 수 있다.

----
// 로컬 -> 원격 호스트
# touch local
# echo test > local
# scp local username@127.0.0.1:. // 원격 호스트로 local 파일보내기
// # scp local username@127.0.0.1:local2 이렇게하면 local2라는 이름으로 보내진다.

// 원격 호스트 -> 로컬
# scp username@127.0.0.1:remote .
// remote라는 파일을 .(현재위치)로 가져온다
----
