= 미디어위키 서버 구축하기

:icons: font
:Author: Byeongsoon Jang
:Email: qudtns1223@gmail.com
:Date: 2020.4.20.
:Revision: 1.0
:imagesdir: ./image

우분투에서 오픈소스 위키엔진인 미디어 위키 서버 구축하기


Byeongsoon Jang<qudtns1223@gmail.com>

---

VirtualBox에서 네트워크 설정을 어댑터에 브릿지로 변경하고 ssh 접속을 위해 어댑터2번을 호스트전용 어댑터로 바꾸고 vboxnet0을 선택해준다.
그리고 ubuntu에서 ifconfig를 통해 ip주소를 알아내어 호스트에서 원격 접속을 시도한다.

image::lamp01.png[어댑터에 브릿지]
image::lamp02.png[어댑터2]

=== 1. CMS란

Apache와 Mysql, PhP를 한번에 다운받을 수 있는 명령어도 존재한다.
----
# sudo apt install lamp-server^
//^(캐럿) :
----

하지만 우분투 환경에서 웹서버에 필요한 요소들을 하나씩 설치하고 설정해 나가면서 직접 서버를 구축하는 방법을 학습한다.

=== 2. Apache 다운로드 설정

----
# sudo apt update
# sudo apt upgrade -y
# sudo apt install apache2

# cd /etc/apache2sites-available
# cat 000-default.conf
----

아래 이미지에 보이는 것처럼 /var/www/html이라는 디렉토리가 DocumentRoot란걸 알 수 있다.
====
DocumentRoot란?

====

image::lamp03.png[DocumentRoot]

=== 3. SQL DataBase 설치하기

----
# sudo apt install mariadb-server -y
# systemctl status mysql
----

image::lamp04.png[status]

----
# mysql_secure_installation // 보안강화하기
// 여기서 sudo 권한이 필요하다면 이후에 처리해야 될 숙제가 있다.
# mysql -u root -p // 여기서도 sudo 권한이 필요하다.
----

----
// sudo 권한으로 mysql_secure_installation를 실행한경우
MriaDB [(none)]> SET PASSWORD = PASSWORD('myPassword');
MriaDB [(none)]> update mysql.user set plugin = 'mysql_native_password' where User='root';
MriaDB [(none)]> FLUSH PRIVILEGES;
----

다음과 같이 3개의 쿼리문을 입력하여 설정을 변경하면 sudo 권한이 없이도 DB에 접속할 수 있다.

image::lamp05.png[]
image::lamp06.png[]

----
MriaDB [(none)]> CREATE DATABASE testdb;
MriaDB [(none)]> use testdb;
// use를 통해 DB를 사용하면 다음과 같이 프롬프트의 none이었던 부분이 DB이름으로 변경된다.
MriaDB [(testdb)]> CREATE TABLE Contacts(
  ID int,
  Name varchar(255),
  Address varchar(255),
  City varchar(255)
);
MriaDB [(testdb)]> INSERT INTO Contacts(ID, Name, Address, City) VALUES ('01','Jang','123 Any st','Boeun');
MriaDB [(testdb)]> SELECT * FROM Contacts;
----

다음과같이 select문의 결과를 확인 할 수 있다.

image::lamp07.png[400,400]

미디어 위키에 사용할 데이터베이스와 user를 생성하고 권한을 부여한다.
----
MriaDB [(none)]> CREATE DATABASE wikidb;
MriaDB [(none)]> CREATE USER 'mw-admin'@'localhost' IDENTIFIED BY 'myPassword';
MriaDB [(none)]> GRANT ALL PRIVILEGES ON wikidb.* TO 'mw-admin'@'localhost' IDENTIFIED BY 'myPassword';
MriaDB [(none)]> FLUSH PRIVILEGES;
MriaDB [(none)]> exit;
----

=== 4. php 설치하기

----
# apt install php libapache2-mod-php -y
// php와 확장모듈 함께 설치

# systemctl restart apache2
----

웹 서버 설정을 변경하면 재시작하는 버릇을 가져야한다.
그리고 php가 정상적으로 동작하는지를 확인하기 위해서 test.php를 작성한다.

----
# sudo vi /var/www/html/test.php

<?php
  phpinfo();
?>
----

이후 웹 창에서 ssh에 접속한 ip주소 뒤에 test.php를 함께 입력하면 다음과 같은 창이 나온다.

image::lamp08.png[phpinfo]

=== 5. 미디어 위키 설치 및 설정하기

지금까지 LAMP에 해당하는 각각의 패키지들을 설치하고 설정해보았다.

이제는 이 학습의 목표인 미디어 위키를 설치하고 설정하겠다.

link:https://www.mediawiki.org/wiki/Download[미디어위키를 내려받는 페이지]에서 직접 다운로드 받던지 wget을 이용해서 다운로드 받는다.
----
# wget https://releases.wikimedia.org/mediawiki/1.34/mediawiki-1.34.1.tar.gz
// 다운로드를 다 받았다면 tar 명령어를 이용해서 압축을 풀자.

# tar xzvf mediawiki-1.34.1.tar.gz
# ls
# sudo cp -r mediawiki-1.34.1/* /var/www/html/
----

여기까지 진행한 후 ssh 접속한 ip주소에 index.php를 접속해보면 다음과같이 아직 완성되지 않은 미디어위키 홈페이지를 볼 수 있다.

image::lamp09.png[]

하지만 무엇이 문제인지 정말 잘 나타나 있기 때문에 빠진 확장 기능 문제를 해결하면 된다.

----
# apt seach mbstring
# sudo apt install php7.2-mbstring php7.2-xml
# systemctl restart apache2
----

다시 접속해보면 다음과 같은 홈페이지가 나오지만 또 다른 문제가 있음을 알 수 있다.

image::lamp10.png[]

바로 데이터베이스 드라이버가 없다는 것이다.

이 드라이버는 php와 myriaDB를 연결을 중재하는 소프트웨어다. 홈페이지에 필요한 패키지들을 나타내고 있다.
다운로드 해주면 된다.

----
# sudo apt install php-mysql php-apcu -y
# systemctl restart apache2
----

apache를 한번만 더 재시작하고 브라우저 화면을 새로고침하면 문제가 해결된다.

=== 6. DataBase에 미디어 위키 연결하기

이 창은 홈페이지에서 진행한다.

DB종류, 설치된 위치, DB명, 사용자계정, 패스워드 등을 적어주면 된다.

이렇게 하고나면 LocalSetting.php 파일 내려받아서 웹서버에 scp를 이용해 전송해면된다.

image::lamp11.png[]

----
// 호스트
# scp LocalSetting.php byeongsoon@192.168.99.100:/home/byeongsoon // 한번에 /var/www/html로 보내고 싶지만 접근이 안된다.

// 서버
# cp LocalSetting.php /var/www/html/
----

LocalSetting.php 파일을 DocumentRoot에 이동시킨 후 브라우저를 다시 접속하면 다음과같이 미디어위키가 성공적으로 나타난다.

image::lamp12.png[]
image::lamp13.png[]

=== 7. CentOS에 Apache Web-Server 설치방법
